
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../concurrency/intro/">
      
      
        <link rel="next" href="../../android/activities/">
      
      
      <link rel="icon" href="../../assets/fatigue-dark.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>Concurrency - listless ðŸ’¤</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Zilla+Slab:300,300i,400,400i,700,700i%7CSono+Monospace:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Zilla Slab";--md-code-font:"Sono Monospace"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#coroutines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="listless ðŸ’¤" class="md-header__button md-logo" aria-label="listless ðŸ’¤" data-md-component="logo">
      
  <img src="../../assets/tired.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            listless ðŸ’¤
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Concurrency
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="listless ðŸ’¤" class="md-nav__button md-logo" aria-label="listless ðŸ’¤" data-md-component="logo">
      
  <img src="../../assets/tired.svg" alt="logo">

    </a>
    listless ðŸ’¤
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Numbers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Numbers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../numbers/representation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Representation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../numbers/arithmetic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arithmetic
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../search/binary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binary Search
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../partition/partition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Partitioning
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Sorting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Sorting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sort/quicksort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quicksort
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sort/mergesort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mergesort
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../heap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heap
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Graph
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Graph
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Traversal
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Traversal
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph/generic-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generic Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph/bfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph/dfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../graph/topological-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Topological Sort
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    JS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            JS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../js/types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Objects
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Objects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../js/object-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Basics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concurrency
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Concurrency
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concurrency/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kotlin
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Kotlin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Concurrency
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Concurrency
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#coroutines_1" class="md-nav__link">
    <span class="md-ellipsis">
      Coroutines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coroutines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatchers" class="md-nav__link">
    <span class="md-ellipsis">
      Dispatchers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-and-async" class="md-nav__link">
    <span class="md-ellipsis">
      launch and async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutinescope" class="md-nav__link">
    <span class="md-ellipsis">
      CoroutineScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutinecontext" class="md-nav__link">
    <span class="md-ellipsis">
      CoroutineContext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Adding it all together
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutinescope_1" class="md-nav__link">
    <span class="md-ellipsis">
      coroutineScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cancelling-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      Cancelling coroutines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suspension-point" class="md-nav__link">
    <span class="md-ellipsis">
      Suspension Point
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#channels" class="md-nav__link">
    <span class="md-ellipsis">
      Channels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow" class="md-nav__link">
    <span class="md-ellipsis">
      Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hot-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Hot Flows
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Android
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../android/activities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../android/tasks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../android/fragments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fragments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../android/animation-transition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Animations
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Miscellaneous
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            Miscellaneous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/display/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Display Upgrade
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#coroutines_1" class="md-nav__link">
    <span class="md-ellipsis">
      Coroutines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coroutines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    <span class="md-ellipsis">
      Intro
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dispatchers" class="md-nav__link">
    <span class="md-ellipsis">
      Dispatchers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-and-async" class="md-nav__link">
    <span class="md-ellipsis">
      launch and async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutinescope" class="md-nav__link">
    <span class="md-ellipsis">
      CoroutineScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutinecontext" class="md-nav__link">
    <span class="md-ellipsis">
      CoroutineContext
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Adding it all together
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutinescope_1" class="md-nav__link">
    <span class="md-ellipsis">
      coroutineScope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cancelling-coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      Cancelling coroutines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#suspension-point" class="md-nav__link">
    <span class="md-ellipsis">
      Suspension Point
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#channels" class="md-nav__link">
    <span class="md-ellipsis">
      Channels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow" class="md-nav__link">
    <span class="md-ellipsis">
      Flow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hot-flows" class="md-nav__link">
    <span class="md-ellipsis">
      Hot Flows
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="coroutines">Coroutines</h1>
<style>
.md-logo img {
  content: url('/kt/k-light.svg');
}

:root [data-md-color-scheme=slate] .md-logo img  {
  content: url('/kt/k-dark.svg');
}
</style>

<h2 id="coroutines_1">Coroutines</h2>
<h3 id="intro">Intro</h3>
<p><a href="https://kotlinlang.org/docs/coroutines-basics.html">source</a> and <a href="https://www.manning.com/books/kotlin-in-action-second-edition">Kotlin in Action 2</a></p>
<p>A coroutine is an instance of suspendable computation. Conceptually similar to a thread, but with a number of advantages:</p>
<ol>
<li>Unlike threads, cheap to make. One can run 100K or more coroutines on a bog standard laptop.</li>
<li>Unlike threads, doesn't block system resources when suspended.</li>
<li>Structured concurrency ensures that child coroutines don't hang around when parent coroutine is cancelled.</li>
</ol>
<p>Under the hood, coroutines are implemented by running on one or more JVM threads. Over its life, a coroutine may start on one thread, suspend, and then resume on another.</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;World!&quot;</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;hello &quot;</span><span class="p">)</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>this prints <code>Hello World!</code>. Let's break it down:</p>
<ol>
<li>
<p><code>runBlocking</code> is a <strong>coroutine builder</strong>, a special one at that which bridges the regular blocking code with suspending functions. Without it, <code>launch</code> line will give the error <code>Unresolved reference: launch</code>. It's called <code>runBlocking</code> because the thread that runs it (i.e. main thread here) gets blocked for the duration of the call.</p>
</li>
<li>
<p><code>launch</code> is another coroutine builder that launches a new coroutine concurrently with the rest of the code. That's why <code>Hello</code> gets printed first.</p>
</li>
<li>
<p><code>delay</code> is a special <strong>suspending function</strong> that suspends the coroutine for the specified time. Unlike <code>Thread.sleep</code>, this does not block the underlying thread, and instead allows other coroutine to take turn.</p>
</li>
<li>
<p>A suspending function can only be called from another suspending function or a coroutine.</p>
</li>
<li>
<p><code>launch</code> is meant for starting coroutines that don't return value. Actually, <code>launch</code> returns a <code>Job</code>, think of a <code>ListenableFuture&lt;Void&gt;</code>.</p>
</li>
<li>
<p>If you want a result from a coroutine, start it with <code>async</code> which returns a <code>Deferred&lt;T&gt;</code>.</p>
</li>
</ol>
<p>Another example:</p>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;parent starts&quot;</span><span class="p">)</span><span class="w">                 </span><span class="c1">// 1</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;second coroutine&quot;</span><span class="p">)</span><span class="w">            </span><span class="c1">// 3</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">100.</span><span class="n">milliseconds</span><span class="p">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;second coroutine resumed&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1">// 5</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">  </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;third coroutine&quot;</span><span class="p">)</span><span class="w">             </span><span class="c1">// 4</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;parent launched 2 coroutines&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">// 2</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>parent starts
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a>parent launched 2 coroutines
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a>second coroutine
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a>third coroutine
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a>second coroutine resumed
</span></code></pre></div></td></tr></table></div>
</div>
<h3 id="dispatchers">Dispatchers</h3>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">Default</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="c1">// do something on default dispatcher</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p><em>Dispatcher</em> determines what thread(s) the coroutine uses for its execution. Dispatchers are inherited by child corountines from their parents. Following dispatchers are available out of the box:</p>
<table>
<thead>
<tr>
<th>Dispatcher</th>
<th>Number of threads</th>
<th>Used for</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Dispatchers.Default</code></td>
<td>Number of CPU cores</td>
<td>General purpose CPU-bound</td>
</tr>
<tr>
<td><code>Dispatchers.Main</code></td>
<td>One</td>
<td>UI work</td>
</tr>
<tr>
<td><code>Dispatchers.IO</code></td>
<td>Auto-scaling <br> \(\text{max}(\text{CPU cores}, 64)\)</td>
<td>Blocking IO task</td>
</tr>
<tr>
<td><code>Dispatchers.Unconfined</code></td>
<td>Any</td>
<td>Used for immediate scheduling</td>
</tr>
<tr>
<td><code>limitedParallelism(n)</code></td>
<td><code>n</code></td>
<td>Custom scenarios</td>
</tr>
</tbody>
</table>
<ul>
<li><code>Unconfined</code> executes coroutine immediately on current thread and later resumes it whatever thread called <code>resume</code>.</li>
<li><code>limitedParallelism(n)</code> creates a <em>view</em> of the current dispatcher but with guarantee that no more than <code>n</code> coroutines are executed at any time.</li>
</ul>
<h3 id="launch-and-async"><code>launch</code> and <code>async</code></h3>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="n">CoroutineScope</span><span class="p">.</span><span class="nf">launch</span><span class="p">(</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EmptyCoroutineContext</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="p">...</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="p">):</span><span class="w"> </span><span class="n">Job</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CoroutineScope</span><span class="p">.</span><span class="nf">async</span><span class="p">(</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">  </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EmptyCoroutineContext</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">  </span><span class="p">...</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="p">):</span><span class="w"> </span><span class="n">Deferred</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<p>Both coroutine builders are actually extension of <code>CoroutineScope</code>. Well, what is a <code>CoroutineScope</code>?</p>
<h3 id="coroutinescope">CoroutineScope</h3>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">CoroutineScope</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">coroutineContext</span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineContext</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>It's just a wrapper arount <code>CoroutineContext</code>. And what is that?</p>
<h3 id="coroutinecontext">CoroutineContext</h3>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1">// Persistent context for the coroutine. It is an indexed set of [Element] instances.</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">CoroutineContext</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">operator</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="o">&lt;</span><span class="n">E</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Element</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">Key</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">E?</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="p">}</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="p">...</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineContext</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">key</span><span class="p">:</span><span class="w"> </span><span class="n">Key</span><span class="o">&lt;*&gt;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">  </span><span class="p">...</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>It's an indexed set of <code>Element</code>s, each of which are <code>CoroutineContext</code> themselves, exemplified in following snippet:</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">foo</span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoroutineName</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="o">[</span><span class="n">CoroutineName</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// CoroutineName(foo)</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="o">[</span><span class="n">Job</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// null</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">bar</span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CoroutineName</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">bar</span><span class="o">[</span><span class="n">CoroutineName</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// CoroutineName(bar)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="o">[</span><span class="n">Job</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// null</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">  </span><span class="n">println</span><span class="p">((</span><span class="n">foo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bar</span><span class="p">)</span><span class="o">[</span><span class="n">CoroutineName</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// CoroutineName(bar)</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">  </span><span class="n">println</span><span class="p">((</span><span class="n">bar</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span><span class="o">[</span><span class="n">CoroutineName</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// CoroutineName(foo)</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>P.S. <code>EmptyCoroutineContext</code> seen before has no elements, as the name implies.  </p>
<mark class="critic block">
<p>That is, coroutine context is a set of "elements". The main elements are <code>Job</code> and the dispatcher.</p>
</mark>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">foo</span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">Default</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Job</span><span class="p">()</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="o">[</span><span class="n">CoroutineName</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// null</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="o">[</span><span class="n">Job</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="c1">// JobImpl{Active}@5c29bfd</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="o">[</span><span class="n">Job</span><span class="o">]?.</span><span class="na">isActive</span><span class="p">)</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">  </span><span class="n">foo</span><span class="p">.</span><span class="na">job</span><span class="p">.</span><span class="na">cancel</span><span class="p">()</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">foo</span><span class="o">[</span><span class="n">Job</span><span class="o">]?.</span><span class="na">isActive</span><span class="p">)</span><span class="w"> </span><span class="c1">// false</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="adding-it-all-together">Adding it all together</h3>
<p><a href="https://elizarov.medium.com/coroutine-context-and-scope-c8b255d59055">Source - Roman Elizarov: Kotlin Project Lead</a></p>
<p>Recall our prior example of launching a coroutine with a given dispatcher:</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="n">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Job</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Passed context = [IO + Job()]</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p><code>launch</code>/<code>async</code> is passed a <code>CoroutineContext</code> as parameter. But it also is an extension of <code>CoroutineScope</code> which itself is wrapping a context. That is, a coroutine builder is actually taking in two contexts.</p>
<p>The two contexts are merged, with elements of passed in context taking precedence over the elements of implicit (scoped) context. This is the <strong>parent context</strong> of the new coroutine. The child context is this <code>parent context</code> \(+\) a new <code>Job()</code> (child of parent job).</p>
<p><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 719.3602843301508 837.2353025023804" width="640">
  <g stroke-linecap="round" transform="translate(10 10) rotate(0 103.66667175292969 104.66664123535156)"><path d="M32 0 C75.47 0, 118.94 0, 175.33 0 C196.67 0, 207.33 10.67, 207.33 32 C207.33 83.37, 207.33 134.74, 207.33 177.33 C207.33 198.67, 196.67 209.33, 175.33 209.33 C143.81 209.33, 112.29 209.33, 32 209.33 C10.67 209.33, 0 198.67, 0 177.33 C0 131.19, 0 85.05, 0 32 C0 10.67, 10.67 0, 32 0" stroke="none" stroke-width="0" fill="#ffec99"></path><path d="M32 0 C61.4 0, 90.79 0, 175.33 0 M32 0 C70.61 0, 109.22 0, 175.33 0 M175.33 0 C196.67 0, 207.33 10.67, 207.33 32 M175.33 0 C196.67 0, 207.33 10.67, 207.33 32 M207.33 32 C207.33 82.25, 207.33 132.51, 207.33 177.33 M207.33 32 C207.33 62.67, 207.33 93.33, 207.33 177.33 M207.33 177.33 C207.33 198.67, 196.67 209.33, 175.33 209.33 M207.33 177.33 C207.33 198.67, 196.67 209.33, 175.33 209.33 M175.33 209.33 C143.38 209.33, 111.43 209.33, 32 209.33 M175.33 209.33 C126.96 209.33, 78.58 209.33, 32 209.33 M32 209.33 C10.67 209.33, 0 198.67, 0 177.33 M32 209.33 C10.67 209.33, 0 198.67, 0 177.33 M0 177.33 C0 128.39, 0 79.46, 0 32 M0 177.33 C0 126.54, 0 75.74, 0 32 M0 32 C0 10.67, 10.67 0, 32 0 M0 32 C0 10.67, 10.67 0, 32 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(32.333343505859375 43.666778564453125) rotate(0 82.33334350585938 83.66667175292969)"><path d="M32 0 C58.41 0, 84.82 0, 132.67 0 C154 0, 164.67 10.67, 164.67 32 C164.67 62.52, 164.67 93.04, 164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 C98.35 167.33, 64.04 167.33, 32 167.33 C10.67 167.33, 0 156.67, 0 135.33 C0 104.59, 0 73.84, 0 32 C0 10.67, 10.67 0, 32 0" stroke="none" stroke-width="0" fill="#b2f2bb"></path><path d="M32 0 C71.82 0, 111.64 0, 132.67 0 M32 0 C69.9 0, 107.8 0, 132.67 0 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M164.67 32 C164.67 69.43, 164.67 106.85, 164.67 135.33 M164.67 32 C164.67 65.01, 164.67 98.02, 164.67 135.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M132.67 167.33 C101.64 167.33, 70.62 167.33, 32 167.33 M132.67 167.33 C111.72 167.33, 90.77 167.33, 32 167.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M0 135.33 C0 111.34, 0 87.35, 0 32 M0 135.33 C0 94.17, 0 53.02, 0 32 M0 32 C0 10.67, 10.67 0, 32 0 M0 32 C0 10.67, 10.67 0, 32 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(56.33332824707031 97.33332824707031) rotate(0 56.66667175292969 24.333328247070312)"><path d="M12.17 0 C33.49 0, 54.8 0, 101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 C113.33 21.59, 113.33 31, 113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 C66.98 48.67, 32.8 48.67, 12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 C0 29.7, 0 22.89, 0 12.17 C0 4.06, 4.06 0, 12.17 0" stroke="none" stroke-width="0" fill="#ffc9c9"></path><path d="M12.17 0 C42.53 0, 72.89 0, 101.17 0 M12.17 0 C45.96 0, 79.75 0, 101.17 0 M101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 M101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 M113.33 12.17 C113.33 20.94, 113.33 29.71, 113.33 36.5 M113.33 12.17 C113.33 19.35, 113.33 26.54, 113.33 36.5 M113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 M113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 M101.17 48.67 C69.59 48.67, 38.01 48.67, 12.17 48.67 M101.17 48.67 C75.16 48.67, 49.15 48.67, 12.17 48.67 M12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 M12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 M0 36.5 C0 26.85, 0 17.2, 0 12.17 M0 36.5 C0 31.08, 0 25.66, 0 12.17 M0 12.17 C0 4.06, 4.06 0, 12.17 0 M0 12.17 C0 4.06, 4.06 0, 12.17 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(73.80001831054688 111.66665649414062) rotate(0 39.199981689453125 10)"><text x="39.199981689453125" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Scope Job</text></g><g transform="translate(52.99998474121094 62.66664123535156) rotate(0 56.86396789550781 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Scope Context</text></g><g stroke-linecap="round" transform="translate(58.33331298828125 153) rotate(0 56.66667175292969 25)"><path d="M12.5 0 C31.9 0, 51.3 0, 100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 C113.33 18.14, 113.33 23.79, 113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 C81.07 50, 61.31 50, 12.5 50 C4.17 50, 0 45.83, 0 37.5 C0 27.55, 0 17.61, 0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="none" stroke-width="0" fill="#a5d8ff"></path><path d="M12.5 0 C34.05 0, 55.6 0, 100.83 0 M12.5 0 C36.76 0, 61.02 0, 100.83 0 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M113.33 12.5 C113.33 19.31, 113.33 26.13, 113.33 37.5 M113.33 12.5 C113.33 19.84, 113.33 27.18, 113.33 37.5 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M100.83 50 C76.45 50, 52.06 50, 12.5 50 M100.83 50 C69.21 50, 37.6 50, 12.5 50 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M0 37.5 C0 30, 0 22.5, 0 12.5 M0 37.5 C0 31.83, 0 26.16, 0 12.5 M0 12.5 C0 4.17, 4.17 0, 12.5 0 M0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(74.76802062988281 158) rotate(0 40.231964111328125 20)"><text x="40.231964111328125" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Scope </text><text x="40.231964111328125" y="34.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">dispatcher</text></g><g transform="translate(55.66667175292969 16.666641235351562) rotate(0 52.327972412109375 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Parent Scope</text></g><g stroke-linecap="round" transform="translate(291.33335876464844 39.40373074054986) rotate(0 82.33334350585938 83.66667175292969)"><path d="M32 0 C70.54 0, 109.07 0, 132.67 0 C154 0, 164.67 10.67, 164.67 32 C164.67 56.83, 164.67 81.67, 164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 C94.89 167.33, 57.12 167.33, 32 167.33 C10.67 167.33, 0 156.67, 0 135.33 C0 100.59, 0 65.84, 0 32 C0 10.67, 10.67 0, 32 0" stroke="none" stroke-width="0" fill="#b2f2bb"></path><path d="M32 0 C59.33 0, 86.66 0, 132.67 0 M32 0 C59.17 0, 86.33 0, 132.67 0 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M164.67 32 C164.67 55.92, 164.67 79.84, 164.67 135.33 M164.67 32 C164.67 55.97, 164.67 79.93, 164.67 135.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M132.67 167.33 C106.63 167.33, 80.6 167.33, 32 167.33 M132.67 167.33 C102.12 167.33, 71.58 167.33, 32 167.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M0 135.33 C0 114.62, 0 93.9, 0 32 M0 135.33 C0 95.92, 0 56.5, 0 32 M0 32 C0 10.67, 10.67 0, 32 0 M0 32 C0 10.67, 10.67 0, 32 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(315.3333435058594 93.07028042316705) rotate(0 56.66667175292969 24.333328247070312)"><path d="M12.17 0 C42.41 0, 72.66 0, 101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 C113.33 18.69, 113.33 25.21, 113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 C75.94 48.67, 50.72 48.67, 12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 C0 29.9, 0 23.29, 0 12.17 C0 4.06, 4.06 0, 12.17 0" stroke="none" stroke-width="0" fill="#ffc9c9"></path><path d="M12.17 0 C46.6 0, 81.04 0, 101.17 0 M12.17 0 C33.57 0, 54.98 0, 101.17 0 M101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 M101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 M113.33 12.17 C113.33 18.76, 113.33 25.35, 113.33 36.5 M113.33 12.17 C113.33 18.25, 113.33 24.33, 113.33 36.5 M113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 M113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 M101.17 48.67 C79.02 48.67, 56.87 48.67, 12.17 48.67 M101.17 48.67 C71.6 48.67, 42.03 48.67, 12.17 48.67 M12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 M12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 M0 36.5 C0 30.66, 0 24.81, 0 12.17 M0 36.5 C0 27.18, 0 17.86, 0 12.17 M0 12.17 C0 4.06, 4.06 0, 12.17 0 M0 12.17 C0 4.06, 4.06 0, 12.17 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(326.1920471191406 107.40360867023736) rotate(0 45.80796813964844 10)"><text x="45.80796813964844" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Passed Job</text></g><g transform="translate(312 58.4035934114483) rotate(0 63.471954345703125 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Passed Context</text></g><g stroke-linecap="round" transform="translate(317.3333282470703 148.73695217609674) rotate(0 56.66667175292969 25)"><path d="M12.5 0 C35.92 0, 59.33 0, 100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 C113.33 21.78, 113.33 31.07, 113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 C67.68 50, 34.53 50, 12.5 50 C4.17 50, 0 45.83, 0 37.5 C0 30.1, 0 22.69, 0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="none" stroke-width="0" fill="#a5d8ff"></path><path d="M12.5 0 C32.3 0, 52.1 0, 100.83 0 M12.5 0 C42.79 0, 73.08 0, 100.83 0 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M113.33 12.5 C113.33 19.63, 113.33 26.76, 113.33 37.5 M113.33 12.5 C113.33 17.7, 113.33 22.91, 113.33 37.5 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M100.83 50 C75.98 50, 51.12 50, 12.5 50 M100.83 50 C70.68 50, 40.52 50, 12.5 50 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M0 37.5 C0 30.18, 0 22.86, 0 12.5 M0 37.5 C0 27.78, 0 18.06, 0 12.5 M0 12.5 C0 4.17, 4.17 0, 12.5 0 M0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(333.7680358886719 153.73695217609674) rotate(0 40.231964111328125 20)"><text x="40.231964111328125" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Passed </text><text x="40.231964111328125" y="34.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">dispatcher</text></g><g transform="translate(224.3333282470703 107.33329772949219) rotate(0 29.199981689453125 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="var(--md-code-fg-color)" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">.launch(</text></g><g transform="translate(464.9999542236328 108.66667175292969) rotate(0 2.7039947509765625 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="var(--md-code-fg-color)" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">)</text></g><g stroke-linecap="round" transform="translate(248.84961572001765 280.3504679325322) rotate(0 9.333343505859375 9)"><path d="M18.67 9 C18.67 9.52, 18.62 10.05, 18.52 10.56 C18.43 11.08, 18.29 11.59, 18.1 12.08 C17.92 12.57, 17.69 13.05, 17.42 13.5 C17.15 13.95, 16.83 14.39, 16.48 14.79 C16.14 15.18, 15.75 15.56, 15.33 15.89 C14.92 16.23, 14.47 16.53, 14 16.79 C13.53 17.05, 13.03 17.28, 12.53 17.46 C12.02 17.64, 11.49 17.77, 10.95 17.86 C10.42 17.95, 9.87 18, 9.33 18 C8.79 18, 8.24 17.95, 7.71 17.86 C7.18 17.77, 6.65 17.64, 6.14 17.46 C5.63 17.28, 5.13 17.05, 4.67 16.79 C4.2 16.53, 3.75 16.23, 3.33 15.89 C2.92 15.56, 2.53 15.18, 2.18 14.79 C1.84 14.39, 1.52 13.95, 1.25 13.5 C0.98 13.05, 0.75 12.57, 0.56 12.08 C0.38 11.59, 0.24 11.08, 0.14 10.56 C0.05 10.05, 0 9.52, 0 9 C0 8.48, 0.05 7.95, 0.14 7.44 C0.24 6.92, 0.38 6.41, 0.56 5.92 C0.75 5.43, 0.98 4.95, 1.25 4.5 C1.52 4.05, 1.84 3.61, 2.18 3.21 C2.53 2.82, 2.92 2.44, 3.33 2.11 C3.75 1.77, 4.2 1.47, 4.67 1.21 C5.13 0.95, 5.63 0.72, 6.14 0.54 C6.65 0.36, 7.18 0.23, 7.71 0.14 C8.24 0.05, 8.79 0, 9.33 0 C9.87 0, 10.42 0.05, 10.95 0.14 C11.49 0.23, 12.02 0.36, 12.53 0.54 C13.03 0.72, 13.53 0.95, 14 1.21 C14.47 1.47, 14.92 1.77, 15.33 2.11 C15.75 2.44, 16.14 2.82, 16.48 3.21 C16.83 3.61, 17.15 4.05, 17.42 4.5 C17.69 4.95, 17.92 5.43, 18.1 5.92 C18.29 6.41, 18.43 6.92, 18.52 7.44 C18.62 7.95, 18.64 8.74, 18.67 9 C18.69 9.26, 18.69 8.74, 18.67 9" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(252.95260327681706 280.5980246022102) rotate(0 5 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="var(--md-code-fg-color)" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">+</text></g><g stroke-linecap="round"><g transform="translate(112.60946970624201 228.84699342119825) rotate(0 64.78562623299743 30.704093191400887)"><path d="M0 0 C4.2 9.21, 3.58 45.03, 25.18 55.27 C46.77 65.5, 112.17 60.38, 129.57 61.41 M0 0 C4.2 9.21, 3.58 45.03, 25.18 55.27 C46.77 65.5, 112.17 60.38, 129.57 61.41" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(112.60946970624201 228.84699342119825) rotate(0 64.78562623299743 30.704093191400887)"><path d="M106.13 70.1 C111.66 68.05, 117.2 66, 129.57 61.41 M106.13 70.1 C112.33 67.8, 118.53 65.5, 129.57 61.41" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(112.60946970624201 228.84699342119825) rotate(0 64.78562623299743 30.704093191400887)"><path d="M106.03 53 C111.59 54.98, 117.14 56.97, 129.57 61.41 M106.03 53 C112.26 55.22, 118.49 57.45, 129.57 61.41" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(381.2615803484467 219.63579638524914) rotate(0 -52.65317361627018 35.002669611448425)"><path d="M0 0 C-1.99 10.34, 5.59 50.35, -11.97 62.02 C-29.52 73.69, -89.75 68.67, -105.31 70.01 M0 0 C-1.99 10.34, 5.59 50.35, -11.97 62.02 C-29.52 73.69, -89.75 68.67, -105.31 70.01" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(381.2615803484467 219.63579638524914) rotate(0 -52.65317361627018 35.002669611448425)"><path d="M-81.85 61.35 C-87.85 63.56, -93.84 65.77, -105.31 70.01 M-81.85 61.35 C-90.63 64.59, -99.41 67.83, -105.31 70.01" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(381.2615803484467 219.63579638524914) rotate(0 -52.65317361627018 35.002669611448425)"><path d="M-81.78 78.45 C-87.79 76.29, -93.8 74.13, -105.31 70.01 M-81.78 78.45 C-90.58 75.29, -99.39 72.13, -105.31 70.01" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(188.40217662014732 344.7568852467318) rotate(0 82.33334350585938 83.66667175292969)"><path d="M32 0 C69.47 0, 106.93 0, 132.67 0 C154 0, 164.67 10.67, 164.67 32 C164.67 60.08, 164.67 88.17, 164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 C98.87 167.33, 65.07 167.33, 32 167.33 C10.67 167.33, 0 156.67, 0 135.33 C0 101.59, 0 67.85, 0 32 C0 10.67, 10.67 0, 32 0" stroke="none" stroke-width="0" fill="#b2f2bb"></path><path d="M32 0 C59.27 0, 86.54 0, 132.67 0 M32 0 C66.29 0, 100.57 0, 132.67 0 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M164.67 32 C164.67 66.27, 164.67 100.53, 164.67 135.33 M164.67 32 C164.67 66.08, 164.67 100.16, 164.67 135.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M132.67 167.33 C111.46 167.33, 90.26 167.33, 32 167.33 M132.67 167.33 C93.24 167.33, 53.8 167.33, 32 167.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M0 135.33 C0 101.97, 0 68.61, 0 32 M0 135.33 C0 101.24, 0 67.15, 0 32 M0 32 C0 10.67, 10.67 0, 32 0 M0 32 C0 10.67, 10.67 0, 32 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(212.40216136135825 398.423434929349) rotate(0 56.66667175292969 24.333328247070312)"><path d="M12.17 0 C33.01 0, 53.85 0, 101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 C113.33 21.1, 113.33 30.03, 113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 C66.59 48.67, 32.01 48.67, 12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 C0 27.51, 0 18.52, 0 12.17 C0 4.06, 4.06 0, 12.17 0" stroke="none" stroke-width="0" fill="#ffc9c9"></path><path d="M12.17 0 C36.56 0, 60.96 0, 101.17 0 M12.17 0 C31.05 0, 49.94 0, 101.17 0 M101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 M101.17 0 C109.28 0, 113.33 4.06, 113.33 12.17 M113.33 12.17 C113.33 18.71, 113.33 25.25, 113.33 36.5 M113.33 12.17 C113.33 17.53, 113.33 22.89, 113.33 36.5 M113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 M113.33 36.5 C113.33 44.61, 109.28 48.67, 101.17 48.67 M101.17 48.67 C81.23 48.67, 61.3 48.67, 12.17 48.67 M101.17 48.67 C69.22 48.67, 37.28 48.67, 12.17 48.67 M12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 M12.17 48.67 C4.06 48.67, 0 44.61, 0 36.5 M0 36.5 C0 27.17, 0 17.83, 0 12.17 M0 36.5 C0 29.04, 0 21.58, 0 12.17 M0 12.17 C0 4.06, 4.06 0, 12.17 0 M0 12.17 C0 4.06, 4.06 0, 12.17 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(224.8048560635067 412.7567631764193) rotate(0 44.26397705078125 10)"><text x="44.26397705078125" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Parent Job</text></g><g transform="translate(209.06881785549888 363.75674791763026) rotate(0 61.92796325683594 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Parent Context</text></g><g stroke-linecap="round" transform="translate(214.4021461025692 454.0901066822787) rotate(0 56.66667175292969 25)"><path d="M12.5 0 C42.44 0, 72.37 0, 100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 C113.33 21.21, 113.33 29.91, 113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 C68.29 50, 35.74 50, 12.5 50 C4.17 50, 0 45.83, 0 37.5 C0 29.32, 0 21.13, 0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="none" stroke-width="0" fill="#a5d8ff"></path><path d="M12.5 0 C46.3 0, 80.09 0, 100.83 0 M12.5 0 C33.61 0, 54.73 0, 100.83 0 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M113.33 12.5 C113.33 19.46, 113.33 26.42, 113.33 37.5 M113.33 12.5 C113.33 17.6, 113.33 22.69, 113.33 37.5 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M100.83 50 C80.78 50, 60.73 50, 12.5 50 M100.83 50 C75.27 50, 49.71 50, 12.5 50 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M0 37.5 C0 29.57, 0 21.64, 0 12.5 M0 37.5 C0 28.89, 0 20.28, 0 12.5 M0 12.5 C0 4.17, 4.17 0, 12.5 0 M0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(230.83685374417075 459.0901066822787) rotate(0 40.231964111328125 20)"><text x="40.231964111328125" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Parent </text><text x="40.231964111328125" y="34.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">dispatcher</text></g><g stroke-linecap="round"><g transform="translate(258.45387722736075 304.07201752356616) rotate(0 0.6140863614965326 15.352032540486277)"><path d="M0 0 C0.2 5.12, 1.02 25.59, 1.23 30.7 M0 0 C0.2 5.12, 1.02 25.59, 1.23 30.7" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(258.45387722736075 304.07201752356616) rotate(0 0.6140863614965326 15.352032540486277)"><path d="M-4.6 16.49 C-2.3 22.09, 0 27.7, 1.23 30.7 M-4.6 16.49 C-2.74 21.02, -0.89 25.54, 1.23 30.7" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(258.45387722736075 304.07201752356616) rotate(0 0.6140863614965326 15.352032540486277)"><path d="M5.9 16.07 C4.06 21.84, 2.22 27.61, 1.23 30.7 M5.9 16.07 C4.41 20.73, 2.92 25.39, 1.23 30.7" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(369.4448400985914 411.6152071236173) rotate(0 97.9439468383789 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="var(--md-code-fg-color)" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">= Scope Job Passed Job</text></g><g stroke-linecap="round"><g transform="translate(387.4109449453599 429.65170161222625) rotate(0 39.915318337778274 -7.061901798318331)"><path d="M0 0 C7.27 -1.33, 30.29 -5.63, 43.6 -7.98 C56.9 -10.34, 73.79 -13.1, 79.83 -14.12 M0 0 C7.27 -1.33, 30.29 -5.63, 43.6 -7.98 C56.9 -10.34, 73.79 -13.1, 79.83 -14.12" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(363.6449949056705 465.0938393691159) rotate(0 156.33587646484375 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="var(--md-code-fg-color)" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">= Parent dispatcher Passed dispatcher</text></g><g stroke-linecap="round"><g transform="translate(378.7688828335922 481.05983177417124) rotate(0 70.61939747396514 -5.526706977398192)"><path d="M0 0 C23.54 -1.84, 117.7 -9.21, 141.24 -11.05 M0 0 C23.54 -1.84, 117.7 -9.21, 141.24 -11.05" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round" transform="translate(177.8152683403746 617.9020200316774) rotate(0 103.66667175292969 104.6666412353515)"><path d="M32 0 C65.03 0, 98.07 0, 175.33 0 C196.67 0, 207.33 10.67, 207.33 32 C207.33 73.65, 207.33 115.3, 207.33 177.33 C207.33 198.67, 196.67 209.33, 175.33 209.33 C131.98 209.33, 88.63 209.33, 32 209.33 C10.67 209.33, 0 198.67, 0 177.33 C0 133.14, 0 88.94, 0 32 C0 10.67, 10.67 0, 32 0" stroke="none" stroke-width="0" fill="#ffec99"></path><path d="M32 0 C63.61 0, 95.22 0, 175.33 0 M32 0 C79.13 0, 126.26 0, 175.33 0 M175.33 0 C196.67 0, 207.33 10.67, 207.33 32 M175.33 0 C196.67 0, 207.33 10.67, 207.33 32 M207.33 32 C207.33 88.11, 207.33 144.21, 207.33 177.33 M207.33 32 C207.33 86.97, 207.33 141.94, 207.33 177.33 M207.33 177.33 C207.33 198.67, 196.67 209.33, 175.33 209.33 M207.33 177.33 C207.33 198.67, 196.67 209.33, 175.33 209.33 M175.33 209.33 C145.23 209.33, 115.13 209.33, 32 209.33 M175.33 209.33 C139.1 209.33, 102.87 209.33, 32 209.33 M32 209.33 C10.67 209.33, 0 198.67, 0 177.33 M32 209.33 C10.67 209.33, 0 198.67, 0 177.33 M0 177.33 C0 130.74, 0 84.15, 0 32 M0 177.33 C0 129.63, 0 81.92, 0 32 M0 32 C0 10.67, 10.67 0, 32 0 M0 32 C0 10.67, 10.67 0, 32 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(200.14861184623396 651.5687985961305) rotate(0 82.33334350585938 83.66667175292963)"><path d="M32 0 C69.12 0, 106.24 0, 132.67 0 C154 0, 164.67 10.67, 164.67 32 C164.67 58.89, 164.67 85.78, 164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 C108.28 167.33, 83.9 167.33, 32 167.33 C10.67 167.33, 0 156.67, 0 135.33 C0 111.69, 0 88.06, 0 32 C0 10.67, 10.67 0, 32 0" stroke="none" stroke-width="0" fill="#b2f2bb"></path><path d="M32 0 C58.25 0, 84.49 0, 132.67 0 M32 0 C62.59 0, 93.17 0, 132.67 0 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M132.67 0 C154 0, 164.67 10.67, 164.67 32 M164.67 32 C164.67 54.75, 164.67 77.51, 164.67 135.33 M164.67 32 C164.67 64.44, 164.67 96.88, 164.67 135.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M164.67 135.33 C164.67 156.67, 154 167.33, 132.67 167.33 M132.67 167.33 C94.24 167.33, 55.81 167.33, 32 167.33 M132.67 167.33 C95.02 167.33, 57.38 167.33, 32 167.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M32 167.33 C10.67 167.33, 0 156.67, 0 135.33 M0 135.33 C0 108.01, 0 80.69, 0 32 M0 135.33 C0 100.3, 0 65.26, 0 32 M0 32 C0 10.67, 10.67 0, 32 0 M0 32 C0 10.67, 10.67 0, 32 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(224.1485965874449 705.2353482787477) rotate(0 56.66667175292969 25)"><path d="M12.5 0 C32.54 0, 52.58 0, 100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 C113.33 21.8, 113.33 31.1, 113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 C79.25 50, 57.66 50, 12.5 50 C4.17 50, 0 45.83, 0 37.5 C0 29.87, 0 22.24, 0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="none" stroke-width="0" fill="#ffc9c9"></path><path d="M12.5 0 C31.53 0, 50.55 0, 100.83 0 M12.5 0 C40.37 0, 68.25 0, 100.83 0 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M113.33 12.5 C113.33 18.17, 113.33 23.83, 113.33 37.5 M113.33 12.5 C113.33 17.56, 113.33 22.63, 113.33 37.5 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M100.83 50 C68.25 50, 35.67 50, 12.5 50 M100.83 50 C75.24 50, 49.64 50, 12.5 50 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M0 37.5 C0 28.94, 0 20.37, 0 12.5 M0 37.5 C0 28.22, 0 18.93, 0 12.5 M0 12.5 C0 4.17, 4.17 0, 12.5 0 M0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(232.79930001762068 710.2353482787477) rotate(0 48.015968322753906 20)"><text x="48.015968322753906" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Child Job = </text><text x="48.015968322753906" y="34.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Job()</text></g><g transform="translate(226.9560885861227 670.5686612670289) rotate(0 52.74395751953122 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Child Context</text></g><g stroke-linecap="round" transform="translate(226.14858132865584 760.9020200316774) rotate(0 56.66667175292969 24.999999999999943)"><path d="M12.5 0 C32.58 0, 52.65 0, 100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 C113.33 20.02, 113.33 27.53, 113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 C72.72 50, 44.61 50, 12.5 50 C4.17 50, 0 45.83, 0 37.5 C0 27.77, 0 18.05, 0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="none" stroke-width="0" fill="#a5d8ff"></path><path d="M12.5 0 C40.59 0, 68.69 0, 100.83 0 M12.5 0 C42.81 0, 73.11 0, 100.83 0 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M100.83 0 C109.17 0, 113.33 4.17, 113.33 12.5 M113.33 12.5 C113.33 21.06, 113.33 29.62, 113.33 37.5 M113.33 12.5 C113.33 20.62, 113.33 28.74, 113.33 37.5 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M113.33 37.5 C113.33 45.83, 109.17 50, 100.83 50 M100.83 50 C81.89 50, 62.94 50, 12.5 50 M100.83 50 C66.08 50, 31.32 50, 12.5 50 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M12.5 50 C4.17 50, 0 45.83, 0 37.5 M0 37.5 C0 29.41, 0 21.33, 0 12.5 M0 37.5 C0 29.6, 0 21.71, 0 12.5 M0 12.5 C0 4.17, 4.17 0, 12.5 0 M0 12.5 C0 4.17, 4.17 0, 12.5 0" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(240.89528543021834 765.9020200316774) rotate(0 41.91996765136719 19.999999999999943)"><text x="41.91996765136719" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Parent </text><text x="41.91996765136719" y="34.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="middle" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Dispatcher</text></g><g transform="translate(232.0790929333993 625.1827616837396) rotate(0 43.14396667480469 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Child Scope</text></g><g stroke-linecap="round"><g transform="translate(214.54704673310437 729.6306192862045) rotate(0 -39.60827515703005 -149.835933732811)"><path d="M0 0 C-13.2 -8.09, -77.78 1.43, -79.22 -48.51 C-80.65 -98.46, -20.37 -257.81, -8.6 -299.67" stroke="var(--md-code-fg-color)" stroke-width="2.5" fill="none" stroke-dasharray="1.5 8"></path></g><g transform="translate(214.54704673310437 729.6306192862045) rotate(0 -39.60827515703005 -149.835933732811)"><path d="M-7.78 -274.69 C-8.07 -283.5, -8.36 -292.32, -8.6 -299.67" stroke="var(--md-code-fg-color)" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g><g transform="translate(214.54704673310437 729.6306192862045) rotate(0 -39.60827515703005 -149.835933732811)"><path d="M-24.03 -280.01 C-18.58 -286.95, -13.14 -293.89, -8.6 -299.67" stroke="var(--md-code-fg-color)" stroke-width="2.5" fill="none" stroke-dasharray="1.5 6"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(270.1214197092961 523.9132764240608) rotate(0 0.9211225146377444 39.915290227350056)"><path d="M0 0 C0.31 13.31, 1.54 66.53, 1.84 79.83 M0 0 C0.31 13.31, 1.54 66.53, 1.84 79.83" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(270.1214197092961 523.9132764240608) rotate(0 0.9211225146377444 39.915290227350056)"><path d="M-7.25 56.54 C-4.27 64.17, -1.29 71.8, 1.84 79.83 M-7.25 56.54 C-4.29 64.12, -1.33 71.7, 1.84 79.83" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g><g transform="translate(270.1214197092961 523.9132764240608) rotate(0 0.9211225146377444 39.915290227350056)"><path d="M9.85 56.15 C7.23 63.9, 4.6 71.66, 1.84 79.83 M9.85 56.15 C7.24 63.86, 4.64 71.56, 1.84 79.83" stroke="var(--md-code-fg-color)" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(284.8594080539283 308.06358590090156) rotate(0 142.96791076660156 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="var(--md-code-fg-color)" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Passed context overwrites elements</text></g><g transform="translate(398.4644713418695 712.1292915080874) rotate(0 155.44790649414062 10)"><text x="0" y="14.016" font-family="Virgil, Segoe UI Emoji" font-size="16px" fill="var(--md-code-fg-color)" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">child context = parent context + Job()</text></g></svg></p>
<p>We can see it all in work like this:</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">  </span><span class="n">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">Default</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">scopeContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentCoroutineContext</span><span class="p">()</span><span class="w">      </span><span class="c1">// [StandaloneCoroutine{Active}@7d6b54ea, Dispatchers.Default]</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">scopeJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scopeContext</span><span class="p">.</span><span class="na">job</span><span class="w">                   </span><span class="c1">//  StandaloneCoroutine{Active}@7d6b54ea</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">parentContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scopeContext</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="w"> </span><span class="c1">// [StandaloneCoroutine{Active}@7d6b54ea, Dispatchers.IO]</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="n">launch</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">IO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="nv">childContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentCoroutineContext</span><span class="p">()</span><span class="w">    </span><span class="c1">// [StandaloneCoroutine{Active}@4bcf3652, Dispatchers.IO]</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">      </span><span class="kd">val</span><span class="w"> </span><span class="nv">childJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">childContext</span><span class="p">.</span><span class="na">job</span><span class="w">                 </span><span class="c1">//  StandaloneCoroutine{Active}@4bcf3652</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">      </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="si">${</span><span class="n">childContext</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">parentContext</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">childJob</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">      </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="si">${</span><span class="n">childJob</span><span class="p">.</span><span class="na">parent</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">scopeJob</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span><span class="w">              </span><span class="c1">// true </span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>Had we passing in <code>Dispatcher.IO + Job()</code> to <code>launch</code>, the <code>childJob</code> would have been child of this new <code>Job</code> instead.</p>
<h3 id="coroutinescope_1"><code>coroutineScope</code></h3>
<p><a href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/coroutine-scope.html">Source</a></p>
<p>In addition to coroutine scope provided by different builders, it is possible to create your own scope using <code>coroutineScope</code>. It creates a new scope and does not complete until all launched children complete.</p>
<p>It looks similar to <code>runBlocking</code>, but <code>runBlocking</code> <strong>blocks</strong> current thread while <code>coroutineScope</code> just suspends. That's why <code>corountineScope</code> is a suspend function whereas <code>runBlocking</code> is a regular function.</p>
<p><code>coroutineScope</code> will fail if any of the child coroutine fail, resulting in cancellation of all other children. If you want other children to still complete regardless, use <code>supervisorScope</code>.</p>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">  </span><span class="n">coroutineScope</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="m">5000L</span><span class="p">)</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">      </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="n">Exception</span><span class="p">()</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">  </span><span class="n">println</span><span class="p">()</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="n">supervisorScope</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="m">5000L</span><span class="p">)</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">      </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="m">1L</span><span class="p">)</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="n">Exception</span><span class="p">()</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">  </span><span class="n">println</span><span class="p">()</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>finishes in right away</p>
<p>finishes after 5 second </p>
<hr>
<hr>
</div>
<h3 id="cancelling-coroutines">Cancelling coroutines</h3>
<p><a href="https://www.manning.com/books/kotlin-in-action-second-edition">Kotlin in Action 2</a></p>
<p>We can call <code>cancel</code> on both <code>Job</code> and <code>Deferred&lt;T&gt;</code> to cancel the coroutine ahead of its time. This is useful in avoiding unnecessary work and leaks. </p>
<p>Cancellation of parent cadcades through all children coroutines. Note that this is different thing from <code>coroutineScope/supervisorScope</code> which is about sibling cancellation.</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">      </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">        </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">          </span><span class="n">delay</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">          </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;descendant 1 done&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// prints</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">        </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">          </span><span class="n">delay</span><span class="p">(</span><span class="m">10</span><span class="n">_000L</span><span class="p">)</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">          </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;descendant 2 done&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// does not print</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="m">1500L</span><span class="p">)</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">  </span><span class="n">job</span><span class="p">.</span><span class="na">cancel</span><span class="p">()</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>this exits right after 1.5s.</p>
<p>We can also use <code>withTimeout</code> and <code>withTimeoutOrNull</code> to automatically cancel a coroutine.</p>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">  </span><span class="n">withTimeout</span><span class="p">(</span><span class="m">50</span><span class="n">_000L</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">10</span><span class="n">_000L</span><span class="p">)</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">  </span><span class="n">withTimeout</span><span class="p">(</span><span class="m">500L</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">10</span><span class="n">_000L</span><span class="p">)</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>prints <code>hello</code> after 10s</p>
<p>aborts after .5s</p>
<hr>
<hr>
</div>
<mark class="critic block">
<p>Cancellation is implemented by throwing a special exception type <code>CancellationException</code>. So never do a catch-all for <code>CancellationException</code> or its super-type <code>IllegalStateException</code>, <code>RuntimeException</code>, <code>Exception</code> and <code>Throwable</code>. Otherwise you will prevent the cancellation.</p>
</mark>
<h3 id="suspension-point">Suspension Point</h3>
<p><a href="https://kotlinlang.org/spec/asynchronous-programming-with-coroutines.html">source 1</a> and <a href="https://kotlinlang.org/docs/cancellation-and-timeouts.html#asynchronous-timeout-and-resources">2</a>.</p>
<p>A suspending function is different from non-suspending functions by having zero or more <em>suspension points</em> - statements in the body where the function execution can be paused and resumed later. Usually that's the points at which the function calls other suspending functions. </p>
<p>That's why non-suspending functions cannot call suspending ones, as they do not support suspension points. Also, suspending functions may call non-suspending functions knowing that it will not introduce a suspension point. <a href="https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/">See function coloring</a>.</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="n">coroutineScope</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="m">500L</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">suspension</span><span class="w"> </span><span class="n">point</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span><span class="n">print</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">)</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>this code will either print <code>A</code> or <code>ABC</code>, but never <code>AB</code> as there are no suspension point between <code>B</code> and <code>C</code>. </p>
<p>Why are we talking about this? Consider the following example:</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">heavyCpuWork</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">  </span><span class="k">while</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="p">}</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">  </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">heavyCpuWork</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">  </span><span class="n">launch</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">heavyCpuWork</span><span class="p">()</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>Just using coroutines will not magically make our code concurrent. In the example above, <code>heavyCpuWork</code> has no suspension point. As a result, even when running on a coroutine, it will never suspend to let other coroutine have a go. The first corountine will finish to completion before second one gets a chance.</p>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">heavyCpuWork</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">  </span><span class="k">while</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="hll"><span class="w">    </span><span class="n">yield</span><span class="p">()</span>
</span></span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span>
<span class="normal"><a href="#__codelineno-20-4">4</a></span>
<span class="normal"><a href="#__codelineno-20-5">5</a></span>
<span class="normal"><a href="#__codelineno-20-6">6</a></span>
<span class="normal"><a href="#__codelineno-20-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">heavyCpuWork</span><span class="p">():</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">  </span><span class="k">while</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="hll"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span></span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">      </span><span class="n">compute</span><span class="p">()</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="hll"><span class="w">    </span><span class="p">}</span>
</span></span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>Use <code>yield</code> function lets coroutine voluntarily give way for other corountines.</p>
<p>The other approach is to explicitly check cancellation status.</p>
</div>
<h2 id="channels">Channels</h2>
<p><a href="https://kotlinlang.org/docs/channels.html">Source</a></p>
<p>Basically <code>BlockingQueue</code> but instead of a blocking <code>put</code>, it has a suspending <code>send</code> and instead of a blocking <code>take</code>, it has a suspending <code>receive</code>.</p>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">produce</span><span class="p">(</span><span class="n">channel</span><span class="p">:</span><span class="w"> </span><span class="n">Channel</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">  </span><span class="n">repeat</span><span class="p">(</span><span class="m">20</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="n">channel</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">  </span><span class="n">channel</span><span class="p">.</span><span class="na">close</span><span class="p">()</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="p">}</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8"></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">consume</span><span class="p">(</span><span class="n">channel</span><span class="p">:</span><span class="w"> </span><span class="n">Channel</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// until channel is closed</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="s">&quot;</span><span class="si">${</span><span class="n">coroutineContext</span><span class="o">[</span><span class="n">CoroutineName</span><span class="o">]?.</span><span class="na">name</span><span class="si">}</span><span class="s"> received </span><span class="si">$</span><span class="n">i</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="p">}</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">  </span><span class="kd">val</span><span class="w"> </span><span class="nv">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Channel</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">()</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">  </span><span class="n">launch</span><span class="p">(</span><span class="n">CoroutineName</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">consume</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">  </span><span class="n">launch</span><span class="p">(</span><span class="n">CoroutineName</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">consume</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="w">  </span><span class="n">launch</span><span class="p">(</span><span class="n">CoroutineName</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">consume</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="w">  </span><span class="n">launch</span><span class="p">(</span><span class="n">CoroutineName</span><span class="p">(</span><span class="s">&quot;D&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">consume</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="w">  </span><span class="n">launch</span><span class="p">(</span><span class="n">CoroutineName</span><span class="p">(</span><span class="s">&quot;P&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">produce</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="w">  </span><span class="n">println</span><span class="p">()</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a>A received 0
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a>B received 1
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a>C received 2
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a>D received 3
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a>A received 4
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a>B received 5
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a>C received 6
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8"></a>D received 7
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9"></a>A received 8
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10"></a>B received 9
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11"></a>C received 10
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12"></a>D received 11
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13"></a>A received 12
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14"></a>B received 13
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15"></a>C received 14
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16"></a>D received 15
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17"></a>A received 16
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18"></a>B received 17
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19"></a>C received 18
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20"></a>D received 19
</span></code></pre></div></td></tr></table></div>
</div>
<p>The example above had no buffer. Unbuffered channels transfer elements when sender and receiver meet each other (i.e. rendezvous). If sender is invoked first, then it gets suspended until receiver is invoked, and vice-versa.</p>
<p>We can optionally specify as capacity <code>Channel&lt;T&gt;(42)</code> which allows sender to send multiple items before getting suspended.</p>
<h2 id="flow">Flow</h2>
<p><a href="https://kotlinlang.org/docs/flow.html">Flow</a></p>
<p><code>Flow</code> is basically <code>Sequence</code> that also support suspending functions. And a sequence is like <code>Stream</code>, but more kotliny.</p>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">produce</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1.</span><span class="p">.</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="n">yield</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="p">}</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">  </span><span class="n">produce</span><span class="p">().</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">produce</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1.</span><span class="p">.</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="n">emit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="p">}</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">  </span><span class="n">produce</span><span class="p">().</span><span class="na">collect</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>Prints <code>1</code>, <code>2</code>, <code>3</code>, <code>4</code>, <code>5</code>, each after 1s delay.</p>
<p>Does the same thing, but doesn't block the thread, just suspends it.</p>
</div>
<p>Notice that the function is no longer marked <code>suspend</code>, why's that? See <code>suspend</code> makes sense when function is returning just one thing and that thing may take time to "cook". <code>Flow</code>, on the other hand, is a lightweight object that's available right away. The function will always return it immediately. So a <code>suspend foo(): Flow</code> is moot in the same manner <code>suspend foo(): ListenableFuture&lt;T&gt;</code> is moot.</p>
<p>Once you got your hands on a flow, then sure it may take time to collect items from it. Which is why <code>collect</code> is still suspending function. </p>
<p>Flows are <strong>cold streams</strong> similar to sequences, i.e. the builder does not run until the flow is <code>collect</code>ed. And you can do the same things to Flows as you can do with Sequences/Streams.</p>
<p>By default, code in <code>flow {...}</code> runs in the context that is provided by its collector. But it can be changed like this:</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">flow</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">  </span><span class="p">...</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="p">}.</span><span class="na">flowOn</span><span class="p">(</span><span class="n">Dispatchers</span><span class="p">.</span><span class="na">Default</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<hr>

<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">produce</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1.</span><span class="p">.</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">    </span><span class="n">emit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="p">}</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">  </span><span class="n">produce</span><span class="p">()</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">  </span><span class="p">.</span><span class="na">collect</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">3000L</span><span class="p">)</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">produce</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1.</span><span class="p">.</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="n">emit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="p">}</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runBlocking</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">  </span><span class="n">produce</span><span class="p">()</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="hll"><span class="w">  </span><span class="p">.</span><span class="na">buffer</span><span class="p">()</span>
</span></span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">  </span><span class="p">.</span><span class="na">collect</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">3000L</span><span class="p">)</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>Takes 4s to print each number (1s + 3s) due to running emit and collect sequentially.</p>
<p><code>buffer</code> runs emitting code of <code>produce</code> concurrently with collecting code. So we wait 1s for first number and then only 3s each number.</p>
</div>
<p>Similar to <code>buffer</code>, use <code>conflate</code> to skip intermediate steps when the collector is too slow and you want to drop in-between emitted values. For <code>xxx</code> operator like <code>collect</code>, there is a family of <code>xxxLatest</code> operators (e.g. <code>collectLatest</code>) that cancel their code on a new value.</p>
<p>We can use <code>catch</code> before <code>collect</code> to grab exceptions thrown by the emitter. Again, note that the <code>collect</code> is not same as <code>collect</code> of <code>Stream</code>s. Without <code>collect</code>, a flow is cold, never emitting a value.</p>
<h2 id="hot-flows">Hot Flows</h2>
<p>Hot flows are useful when sharing emitted items across multiple collectors, this time called <em>subscribers</em>. Which is why it doesn't make sense for relying on a collector to start collecting. </p>
<p>It's like broadcasting. A TV station or a twitch stream will broadcast, regardless of whether there are any viewers or not.</p>
<p>Kotlin has two implementations of hot flows out of the box: <em>Shared flows</em> and <em>State flows</em>.</p>
<div class="grid">
<div class="language-kotlin highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">producer</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span>
<span class="normal"><a href="#__codelineno-28-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">flow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableSharedFlow</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">()</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">broadcast</span><span class="p">(</span><span class="n">scope</span><span class="p">:</span><span class="w"> </span><span class="n">CoroutineScope</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">  </span><span class="n">repeat</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="m">1000L</span><span class="p">)</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">    </span><span class="n">flow</span><span class="p">.</span><span class="na">emit</span><span class="p">(</span><span class="s">&quot;ping&quot;</span><span class="p">)</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="p">}</span><span class="w"> </span>
</span></code></pre></div></td></tr></table></div>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">subscriber</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">readOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flow</span><span class="p">.</span><span class="na">asSharedFlow</span><span class="p">()</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="n">readOnly</span><span class="p">.</span><span class="na">collect</span><span class="p">{</span><span class="w"> </span><span class="n">println</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
<p>Subscribers only receive emissions that happened after they called <code>collect</code>. A hot flow can let you see some past broadcast with <code>replay</code> param: <code>MutableSharedFlow&lt;Int&gt;(replay = 10)</code>.</p>
<p>A special case of hot flow is when you need to track state of a system right now and don't care for past values.</p>
<div class="language-kotlin highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">viewWriter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// inital views = 0</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">private</span><span class="w"> </span><span class="n">vale</span><span class="w"> </span><span class="n">viewReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewWriter</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span><span class="w"> </span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">  </span><span class="n">viewWriter</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="p">}</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">  </span><span class="n">increment</span><span class="p">()</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="w">  </span><span class="n">println</span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="na">value</span><span class="p">)</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p><code>StateFlow</code> only emit last known value, so no <code>relay</code>. They also come with a start value in the constructor that's emitted immediately. In general, it's a simpler API.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.expand", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>